---
import type { SockbaseEventDocument } from "sockbase";
import Root from "../layouts/Root.astro";
import eventLib from "../libs/event";
import listLib from "../libs/list";

const listControls = await listLib.getListControlsAsync();
const publishedLists = listControls.filter((control) => control.isPublic);
const eventIds = publishedLists.map((control) => control.eventId);
const events = await Promise.all(eventIds.map(async id => ({
	id,
	data: await eventLib.getEventByIdAsync(id),
})))
	.then(fetchedEvents => fetchedEvents.reduce((p, c) => ({ ...p, [c.id]: c.data }), {} as Record<string, SockbaseEventDocument>));

---

<Root>
	<h1>Sockbase サークルリスト</h1>
	<h2>現在公開されているサークルリスト</h2>
	<ul>
		{publishedLists.map((control) => (
			<li>
				<a href={`/events/${control.eventId}`}>{events[control.eventId].name}</a>
			</li>
		))}
	</ul>
</Root>
